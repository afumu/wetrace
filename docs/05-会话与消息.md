# 会话与消息

WeTrace 的核心功能是浏览和分析微信聊天记录。本章介绍如何查看会话列表、阅读各类消息、搜索聊天内容以及使用筛选功能。

## 会话列表

进入 WeTrace 后，点击左侧导航栏的「聊天」进入会话页面。页面左侧为会话列表，右侧为消息区域。

### 浏览会话

- 会话列表展示所有私聊和群聊会话，按最近活跃时间排序
- 每个会话项显示头像、会话名称（昵称或群名）
- 系统会话（如公众号、占位符）会自动过滤，不在列表中显示

### 搜索会话

会话列表顶部有搜索框，输入关键词可实时筛选会话：
1. 在搜索框中输入会话名称或备注
2. 列表会实时过滤，仅显示匹配的会话
3. 清空搜索框即可恢复完整列表

### 选择会话

点击任意会话项，右侧消息区域将加载该会话的全部聊天记录。当前选中的会话会高亮显示。

### 删除会话

如需删除某个会话，可在会话项上进行删除操作。删除后该会话将从列表中移除。

> 注意：删除会话仅移除列表显示，不会删除原始数据库中的消息数据。

## 消息查看

选中会话后，右侧消息区域以聊天气泡形式展示所有消息。消息按时间顺序排列，使用虚拟滚动技术，即使数万条消息也能流畅浏览。

### 消息布局

- 自己发送的消息显示在右侧（绿色气泡）
- 对方发送的消息显示在左侧（白色气泡）
- 每条消息旁显示发送者头像
- 群聊中，非自己的消息会显示发送者昵称
- 当两条消息间隔超过 5 分钟，或跨天时，会自动插入时间标签

### 支持的消息类型

WeTrace 支持查看以下微信消息类型：

| 消息类型 | 说明 |
|---------|------|
| 文本消息 | 普通文字内容，直接显示在气泡中 |
| 图片消息 | 显示图片缩略图，点击可查看大图 |
| 语音消息 | 显示语音条和时长，点击可播放 MP3 音频 |
| 视频消息 | 显示视频缩略图，点击可播放视频 |
| 表情消息 | 显示微信自定义表情和表情包 |
| 链接卡片 | 显示分享链接的标题、描述和缩略图 |
| 红包消息 | 显示红包样式卡片 |
| 转账消息 | 显示转账金额和状态 |
| 文件消息 | 显示文件名、大小等信息的卡片 |
| 合并转发 | 显示合并转发的消息摘要卡片，可展开查看详情 |
| 引用消息 | 显示引用的原始消息和回复内容 |
| 系统消息 | 居中显示的灰色提示文字（如撤回提示、拍一拍等） |

> 对于暂不支持的消息类型，会以 `[不支持的消息类型]` 提示显示。

## 消息搜索

WeTrace 提供两种搜索方式：会话内搜索和全局搜索。

### 会话内搜索

在消息区域顶部有搜索框，可在当前会话内搜索消息：

1. 在搜索框中输入关键词
2. 搜索结果以下拉列表形式展示，显示发送者和时间
3. 点击某条搜索结果，消息列表会自动滚动到该消息位置
4. 点击搜索结果面板的「关闭」按钮或清空搜索框可退出搜索

### 全局搜索

点击左侧导航栏的「搜索」进入全局搜索页面，可跨所有会话搜索消息：

1. 在搜索框中输入关键词，点击「搜索」按钮或按回车键
2. 搜索结果以卡片列表展示，每条结果显示会话名称、发送者、时间和匹配内容
3. 匹配的关键词会高亮显示

#### 查看上下文

在全局搜索结果中，每条结果下方有两个操作按钮：

- **查看上下文**：点击后弹出上下文面板，显示该消息前后各 10 条消息，帮助理解对话背景
- **跳转到会话**：点击后直接跳转到聊天页面，并自动定位到该消息位置

#### 高级筛选

点击搜索框右侧的「筛选」按钮，展开高级筛选面板，支持以下条件：

| 筛选条件 | 说明 |
|---------|------|
| 会话 ID | 限定在某个特定会话中搜索 |
| 发送人 ID | 限定某个特定发送者的消息 |
| 开始日期 | 搜索该日期之后的消息 |
| 结束日期 | 搜索该日期之前的消息 |

点击「清除筛选」可一键重置所有筛选条件。搜索结果支持分页浏览，每页显示 20 条结果。

## 日期跳转

在消息区域右上角有一个日历图标按钮，点击后可选择日期快速跳转：

1. 点击消息区域右上角的日历图标
2. 在弹出的日期选择器中选择目标日期
3. 消息列表会自动滚动到该日期的第一条消息

此外，当消息列表向下滚动后，右上角会出现一个向上箭头按钮，点击可快速回到消息列表顶部。

## 工具栏功能

选中会话后，消息区域顶部的工具栏提供以下快捷操作：

- **AI 总结**：使用 AI 自动总结当前会话的近期对话内容
- **导出**：打开导出对话框，选择格式导出聊天记录（详见「数据导出」章节）
- **更多** 菜单：
  - AI 功能：模拟对话（仅私聊）、会话分析
  - 媒体：加载图片（预缓存会话图片）、查看图片（打开会话图片画廊）、导出语音（批量导出语音为 ZIP）
  - 其他：同步数据（重新解密并刷新数据）

> 提示：WeTrace 为只读模式，底部输入框仅作展示，无法发送消息。
