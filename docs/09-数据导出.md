# 数据导出

WeTrace 提供丰富的数据导出功能，支持多种格式导出聊天记录、联系人和语音消息，满足不同场景的需求。

## 导出入口

在聊天页面选中一个会话后，点击顶部工具栏的「导出」按钮，即可打开导出对话框。

## 导出对话框

导出对话框分为两个部分：格式选择和时间范围设置。

### 选择导出格式

点击对应的格式卡片进行选择，当前选中的格式会高亮显示。支持以下 7 种格式：

| 格式 | 说明 |
|------|------|
| 网页导出 (HTML) | 包含图片、视频的可视化交互式网页，打包为 ZIP |
| 纯文本 (TXT) | 仅包含文字内容，易于阅读 |
| CSV 表格 | 逗号分隔格式，可用 Excel 打开 |
| Excel 表格 (XLSX) | Excel 格式，带表头和格式 |
| Word 文档 (DOCX) | Word 格式，按日期分段排版 |
| JSON 数据 | 原始数据格式，适合开发者 |
| 法律取证导出 | 含取证报告、数据校验、水印和签名区域 |

### 时间范围设置

导出对话框下方提供时间范围选择：

- **全部记录**：导出该会话的所有消息（默认）
- **自定义范围**：点击后展开日期选择器，设置开始日期和结束日期

选择「自定义范围」时，必须同时设置开始和结束日期才能执行导出。

### 执行导出

设置好格式和时间范围后，点击「开始导出」按钮。浏览器将自动下载导出文件。

## 各格式详解

### HTML 网页导出（ZIP）

这是默认的导出格式，生成一个包含完整交互式查看器的 ZIP 压缩包。

ZIP 包内容：
- `index.html`：交互式聊天记录查看器，可在浏览器中直接打开
- `data.js`：聊天消息的 JSON 数据
- 媒体文件夹：包含聊天中的图片、视频等媒体文件
- 静态资源：CSS 样式和 JavaScript 脚本

使用方式：
1. 下载 ZIP 文件后解压
2. 双击 `index.html` 在浏览器中打开
3. 即可浏览完整的聊天记录，包括图片和视频

文件名格式：`chat_export_会话名_会话ID.zip`

### 纯文本导出（TXT）

将聊天记录导出为纯文本文件，仅包含文字内容。

每条消息格式为：
```
[发送者] 时间  消息内容
```

消息按日期分组，每个日期前有分隔线标记。适合快速阅读和文本检索。

文件名格式：`chat_export_会话名_会话ID.txt`

### CSV 表格导出

将聊天记录导出为逗号分隔的表格文件，包含 UTF-8 BOM 标记以确保中文在 Excel 中正确显示。

适用场景：数据分析、批量处理、导入其他系统。

文件名格式：`chat_export_会话名_会话ID.csv`

### Excel 表格导出（XLSX）

将聊天记录导出为 Excel 格式文件，带有格式化的表头和合适的列宽。

适用场景：需要在 Excel 中进行排序、筛选或进一步分析。

文件名格式：`chat_export_会话名_会话ID.xlsx`

### Word 文档导出（DOCX）

将聊天记录导出为 Word 文档，按日期分段排版，适合打印和正式文档归档。

文件名格式：`chat_export_会话名_会话ID.docx`

### PDF 文档导出

将聊天记录导出为 PDF 文件，采用 A4 页面尺寸排版。

PDF 特性：
- 首页包含标题（会话名称）、导出时间和消息总数
- 消息按日期分组，每组有日期分隔标记
- 每条消息显示发送者、时间和内容
- 自动换行和分页，支持中文字体
- 支持 macOS、Windows 和 Linux 系统字体

文件名格式：`chat_export_会话名_会话ID.pdf`

### 法律取证导出

这是专为法律取证场景设计的导出格式，生成包含完整性验证和专业取证特性的 ZIP 压缩包。

ZIP 包内容：
- `index.html`：带取证水印的交互式聊天记录查看器
- `data.js`：聊天消息的 JSON 数据
- `metadata.json`：取证元数据文件
- 媒体文件：聊天中的图片、视频等

取证特性：

#### 取证水印

导出的 HTML 页面全页覆盖半透明水印，水印内容包含：
- 「取证证据 FORENSIC」标识
- 唯一报告编号（如 `FORENSIC-20260211143025-a3b2c1`）
- 导出日期

水印以 SVG 背景图形式渲染，旋转 -30 度平铺，不可选中、不影响内容阅读。

#### 取证摘要卡片

HTML 页面顶部显示专业的取证摘要信息卡片，包含：

| 字段 | 说明 |
|------|------|
| 报告编号 | 唯一标识，格式为 `FORENSIC-时间戳-哈希` |
| 导出时间 | 报告生成的精确时间 |
| 聊天对象 | 会话名称和会话 ID |
| 消息总数 | 导出的消息条数 |
| 起始时间 | 消息时间范围的起点 |
| 截止时间 | 消息时间范围的终点 |
| 数据校验指纹 | 消息数据的 SHA-256 哈希值，用于验证数据完整性 |

#### 完整性验证

取证导出使用 SHA-256 算法对全部消息数据计算哈希指纹。该指纹同时记录在：
- HTML 页面的取证摘要卡片中
- `metadata.json` 元数据文件中

如需验证数据是否被篡改，可重新计算 `data.js` 中消息数据的 SHA-256 哈希值，与记录的指纹进行比对。

#### 签名区域

HTML 页面底部包含签名区域，提供：
- WeTrace 取证报告声明
- 导出人员签名栏（手写签名用）
- 日期栏

打印后可由相关人员手写签名，增强法律效力。

文件名格式：`forensic_export_会话名_会话ID.zip`

### JSON 数据导出

将聊天记录以原始 JSON 格式导出，包含所有消息字段和元数据。

适用场景：开发者进行二次开发、数据迁移或自定义分析。

文件名格式：`messages_会话ID.json`

## 语音批量导出

除了通过导出对话框导出聊天记录外，WeTrace 还支持单独批量导出会话中的语音消息。

### 操作步骤

1. 在聊天页面选中一个会话
2. 点击顶部工具栏的「更多」按钮
3. 在下拉菜单的「媒体」分组中点击「导出语音」
4. 系统会自动检测当前会话中的语音消息数量
5. 显示加载提示（如「正在准备导出 15 条语音...」）
6. 导出完成后自动下载 ZIP 文件

### ZIP 包内容

ZIP 包中每条语音为一个独立的 MP3 文件，文件命名规则：

- 有消息时间信息时：`序号_发送者_日期时间.mp3`（如 `001_张三_20260101_143025.mp3`）
- 无时间信息时：`序号_语音ID.mp3`（如 `001_voice123.mp3`）

文件名格式：`voices_会话名_日期.zip`

> 如果当前会话中没有语音消息，系统会提示「当前页面未发现语音消息」。

## 联系人导出

联系人导出功能位于「联系人」页面，详细操作请参见「联系人管理」章节。

支持两种格式：

| 格式 | 说明 |
|------|------|
| CSV | 逗号分隔文本，含 UTF-8 BOM，Excel 可直接打开 |
| XLSX | Excel 格式，带加粗表头和列宽设置 |

导出字段包括：微信ID、微信号、昵称、备注、是否好友。

文件名格式：`contacts_export_日期.csv` 或 `contacts_export_日期.xlsx`

## 导出格式选择建议

| 使用场景 | 推荐格式 |
|---------|---------|
| 日常浏览和分享 | HTML 网页导出 |
| 快速阅读文字内容 | 纯文本 (TXT) |
| 数据分析和统计 | CSV 或 XLSX |
| 正式文档归档 | DOCX 或 PDF |
| 法律诉讼取证 | 法律取证导出 |
| 程序开发和数据迁移 | JSON |
| 保存语音证据 | 语音批量导出 |
