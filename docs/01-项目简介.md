# WeTrace 项目简介

## 项目定位

WeTrace 是一款专为 PC 端微信设计的聊天记录取证、备份与可视化分析工具。它能够自动提取微信数据库密钥，解密并解析本地数据库，通过 Web 界面提供浏览、搜索、导出以及深度聊天行为分析功能。

所有数据完全在本地处理，不上传任何隐私信息，确保数据安全。

## 功能概览

WeTrace 提供 13 个主要页面，涵盖 50+ 项操作能力：

| 页面 | 功能说明 |
|------|----------|
| 聊天记录 (`/chat`) | 浏览会话列表，查看完整聊天记录，支持图片、语音、视频、表情包等多媒体预览 |
| 联系人详情 (`/contact`) | 查看单个联系人的详细信息与聊天统计 |
| 通讯录 (`/contacts`) | 浏览完整通讯录列表，支持导出联系人信息 |
| 全局搜索 (`/search`) | 跨会话关键词检索，支持上下文定位 |
| 年度报告 (`/report`) | 生成年度聊天数据报告，展示全年互动概况 |
| 情感分析 (`/sentiment`) | 基于 AI 的聊天情感倾向分析 |
| 词云 (`/wordcloud`) | 生成全局或单会话的聊天词云图 |
| AI 工具 (`/ai-tools`) | AI 聊天摘要、模拟对话、待办提取、信息提取、语音转文字 |
| 图库 (`/gallery`) | 浏览聊天中的所有图片，支持缓存管理 |
| 设置 (`/settings`) | 系统配置、密钥管理、数据解密、AI 配置、同步备份、密码保护 |
| 消息监控 (`/monitor`) | 配置关键词/联系人监控规则，支持飞书推送通知 |
| 聊天回放 (`/replay`) | 按时间线回放聊天记录 |
| 联系提醒 (`/contact-reminder`) | 提醒长时间未联系的重要联系人 |

## 核心能力

- **自动密钥提取**：自动获取微信数据库密钥（DB Key）及媒体解密密钥（Image Key / XOR Key）
- **数据库解密**：基于 AES-256-CBC + PBKDF2 + HMAC-SHA512 解密微信加密数据库
- **多版本兼容**：支持 PC 微信 v4 版本数据库格式
- **多媒体处理**：图片解密、语音转码（Silk → MP3）、视频播放、表情包渲染
- **数据分析**：时间维度统计（小时/天/周/月）、消息类型分布、群成员活跃度、重复话术识别
- **AI 集成**：支持 OpenAI 兼容接口，提供聊天摘要、情感分析、模拟对话等 AI 功能
- **取证导出**：支持导出为 HTML、PDF、Excel、Word 等格式
- **实时监控**：关键词/联系人监控，支持飞书 Bot 推送
- **自动同步与备份**：定时同步微信数据，自动备份解密后的数据库

## 技术架构

WeTrace 采用 Go + React/TypeScript 全栈架构，前端通过 `go:embed` 嵌入到后端二进制文件中，实现单文件部署。

### 架构总览

```
┌─────────────────────────────────────────────────────────┐
│                    用户浏览器                              │
│              React 19 + TypeScript + Vite                │
│         TailwindCSS / Zustand / React Query              │
└──────────────────────┬──────────────────────────────────┘
                       │ HTTP REST API
                       ▼
┌─────────────────────────────────────────────────────────┐
│                   Go 后端服务                              │
│              Gin Web Framework (端口 5200)                │
│  ┌─────────┐  ┌──────────┐  ┌────────┐  ┌───────────┐  │
│  │ API 层  │  │ 媒体服务  │  │ AI 服务 │  │ 监控/同步  │  │
│  └────┬────┘  └────┬─────┘  └───┬────┘  └─────┬─────┘  │
│       └────────────┴────────────┴──────────────┘        │
│                        │                                 │
│              ┌─────────▼─────────┐                      │
│              │   Store 数据层     │                      │
│              │  (SQLite 读取)     │                      │
│              └─────────┬─────────┘                      │
└────────────────────────┼────────────────────────────────┘
                         │
              ┌──────────▼──────────┐
              │  解密后的 SQLite 文件  │
              │    (data/ 目录)       │
              └──────────▲──────────┘
                         │ 解密
              ┌──────────┴──────────┐
              │  微信加密数据库文件    │
              │  (db_storage/*.db)   │
              └─────────────────────┘
```

### 数据流

```
微信进程 → 密钥提取(DLL注入) → 获取 DB Key / Image Key
                                      │
微信数据目录(db_storage/*.db) ──────────┤
                                      ▼
                              AES-256-CBC 解密
                              (PBKDF2 + HMAC-SHA512)
                                      │
                                      ▼
                              解密后 SQLite 文件
                              (data/ 目录)
                                      │
                                      ▼
                              Store 数据层读取
                              (消息/联系人/群聊/媒体)
                                      │
                                      ▼
                              Gin REST API 提供服务
                                      │
                                      ▼
                              React 前端展示与交互
```

### 技术栈

| 层级 | 技术 |
|------|------|
| 前端框架 | React 19 + TypeScript |
| 构建工具 | Vite 7 |
| UI 样式 | TailwindCSS 4 |
| 状态管理 | Zustand |
| 数据请求 | TanStack React Query + Axios |
| 路由 | React Router v7 |
| 图表 | Recharts |
| 后端框架 | Go 1.24 + Gin |
| 数据库 | SQLite (go-sqlite3) |
| 配置管理 | Viper (.env 文件) |
| 日志 | Zerolog |
| 加密 | AES-256-CBC / PBKDF2 / HMAC-SHA512 |
| 音频处理 | go-silk + go-lame (Silk → MP3) |
| 文档导出 | excelize (Excel)、godocx (Word)、gopdf (PDF) |
| 前端嵌入 | Go embed (ui/dist 编译到二进制) |

## 项目目录结构

```
wetrace/
├── main.go              # 程序入口，加载配置并启动 Web 服务
├── .env                 # 环境配置文件（运行时自动创建）
├── go.mod               # Go 模块依赖
├── decrypt/             # 数据库解密核心逻辑 (AES-CBC)
├── key/                 # 密钥提取相关
├── wxkey/               # 微信密钥 DLL 注入工具
├── store/               # 数据访问层（SQLite 读取）
├── internal/            # 内部模块
│   ├── model/           # 数据模型定义
│   ├── ai/              # AI 客户端
│   ├── backup/          # 自动备份
│   ├── monitor/         # 消息监控
│   ├── sync/            # 数据同步
│   └── tts/             # 语音转文字
├── web/                 # Web 服务层
│   ├── api/             # API 处理器
│   ├── media/           # 媒体文件服务
│   ├── export/          # 导出功能
│   ├── middleware/       # 中间件（认证、CORS）
│   └── transport/       # 响应封装
├── pkg/                 # 公共包
│   ├── config/          # 配置管理工具
│   ├── util/            # 通用工具函数
│   └── wordcloud/       # 词云生成
├── ui/                  # React 前端项目
│   ├── src/views/       # 页面组件（13个视图）
│   ├── src/api/         # API 调用封装
│   ├── src/components/  # 公共组件
│   └── src/stores/      # Zustand 状态管理
└── script/              # 构建与部署脚本
```
