# 配置说明

## 配置文件

WeTrace 使用项目根目录下的 `.env` 文件进行配置。程序启动时会自动读取该文件，如果文件不存在则自动创建。

配置也可以通过系统环境变量设置，环境变量优先级高于 `.env` 文件。

## 配置项详解

### 基础服务配置

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `LISTEN_ADDR` | `127.0.0.1:5200` | 服务监听地址，格式为 `IP:端口`。设置后 `PORT` 配置失效 |
| `PORT` | `5200` | 服务端口号。仅在 `LISTEN_ADDR` 未设置时生效，监听地址为 `127.0.0.1:PORT` |
| `WORK_DIR` | `data` | 工作目录，存放解密后的 SQLite 数据库文件 |

### 微信数据配置

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `WECHAT_DB_SRC_PATH` | 空 | 微信数据存储目录路径，通常为 `Documents\WeChat Files\wxid_xxx` |
| `WECHAT_DB_KEY` | 空 | 微信数据库解密密钥（64位十六进制字符串，即32字节） |
| `IMAGE_KEY` | 空 | 图片解密密钥 |
| `XOR_KEY` | 空 | 图片 XOR 解密密钥，用于解密微信本地图片文件 |

### 密钥提取工具配置（仅 Windows）

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `WXKEY_DLL_PATH` | 空 | 密钥提取 DLL 文件路径 |
| `WXKEY_WECHAT_PATH` | 空 | 微信安装路径（如 `C:\Program Files\Tencent\WeChat`） |
| `WXKEY_WECHAT_DATA_PATH` | 空 | 微信数据存储路径（如 `C:\Users\xxx\Documents\WeChat Files`） |

### AI 功能配置

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `AI_ENABLED` | `false` | 是否启用 AI 功能 |
| `AI_PROVIDER` | 空 | AI 服务提供商标识（如 `openai`） |
| `AI_API_KEY` | 空 | AI 服务 API 密钥 |
| `AI_BASE_URL` | 空 | AI 服务 API 地址，支持 OpenAI 兼容接口 |
| `AI_MODEL` | 空 | 使用的 AI 模型名称（如 `gpt-4o`、`deepseek-chat`） |

> AI 功能支持任何兼容 OpenAI API 格式的服务，包括 OpenAI、DeepSeek、本地部署的 Ollama 等。

## 配置示例

以下是一个完整的 `.env` 配置示例：

```env
# 服务配置
LISTEN_ADDR=127.0.0.1:5200
WORK_DIR=data

# 微信数据配置
WECHAT_DB_SRC_PATH=C:\Users\xxx\Documents\WeChat Files\wxid_xxx
WECHAT_DB_KEY=your_64_char_hex_key_here

# 图片解密
IMAGE_KEY=
XOR_KEY=

# 密钥提取工具（Windows）
WXKEY_DLL_PATH=
WXKEY_WECHAT_PATH=C:\Program Files\Tencent\WeChat
WXKEY_WECHAT_DATA_PATH=C:\Users\xxx\Documents\WeChat Files

# AI 功能
AI_ENABLED=true
AI_PROVIDER=openai
AI_API_KEY=sk-xxx
AI_BASE_URL=https://api.openai.com/v1
AI_MODEL=gpt-4o
```

## 配置优先级

配置值的读取优先级从高到低为：

1. 系统环境变量
2. `.env` 文件中的值
3. 程序内置默认值

## 运行时配置

除了 `.env` 文件中的静态配置外，以下配置可以在 Web 界面的"设置"页面中动态修改：

- **AI 配置**：通过 `/settings` 页面配置 AI 服务参数，支持在线测试连接
- **AI 提示词**：自定义 AI 功能使用的提示词模板
- **同步配置**：设置自动同步微信数据的策略
- **备份配置**：设置自动备份的目录和频率
- **密码保护**：设置/修改/禁用访问密码
- **TTS 配置**：语音转文字服务配置
- **监控规则**：关键词/联系人监控与推送配置
- **飞书集成**：飞书 Bot 推送和多维表格配置

这些运行时配置通过 API 接口 `/api/v1/system/*` 进行读写，持久化存储在本地。
